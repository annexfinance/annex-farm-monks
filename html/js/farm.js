"use strict";function ownKeys(e,t){var i,a=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)),a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],a=!0,n=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(a=(o=c.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(t){n=!0,r=t}finally{try{a||null==c.return||c.return()}finally{if(n)throw r}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}var BSC=56,NETWORK=1,pairList=[],sortField="apy",sortDirection="desc",searchKeyward="";function initHook(){window.hooks.forEach(createHook)}function initFarm(){console.log("initFarm"),initData(function(t,e){console.log("POOOOOOOLS : ",t),window.variables.PAIR_TOKEN_CONTRACTS=e,window.variables.farm.POOLS=t,window.variables.farm.USERS=[],window.variables.farm.ALLOWANCES=[],window.variables.ACCOUNT?updateFarm():(pairList=t,sortData()),refreshFarm()})}function updateFarm(){window.variables.farm.POOLS&&(pairList=window.variables.farm.POOLS,initUserData(function(){sortData()}))}function refreshFarm(){setTimeout(function(){updateFarm(),refreshFarm()},3e4)}function onNetworkChanged(){$(".farm-list-items-item").remove(),$("#loading").show(),$("#no-pools").hide()}function initData(c){var t=window.variables.CONTRACT_TOKEN_ADDRESS,e=void 0===t?values[56].CONTRACT_TOKEN_ADDRESS:t;Promise.all([getLiquidityPositions(),getPools(),getAverageBlockTime(),getToken(e),getEthPrice()]).then(function(t){var e=_slicedToArray(t,5),p=e[0],r=e[1],f=e[2],i=e[3],a=e[4];console.log([p,r,f,i,a]);var n=0!==a.length?a[0].ethPrice:0,b=n*i.derivedETH,o=r.map(function(t){return t.pair}).sort(),y=(window.variables||y).NETWORK;Promise.all([getPairs(o,n,b),getFarmALPBalance(r)]).then(function(t){var e=_slicedToArray(t,2),m=e[0],i=e[1],v=i.balances,a=i.pairTokenContracts,n=r.filter(function(e){return!window.variables.POOL_DENY.includes(e.id)&&"0"!==e.allocPoint&&m.find(function(t){return(null==t?void 0:t.id)===e.pair})}).map(function(e){var i=m.find(function(t){return t.id===e.pair}),t=p.find(function(t){return t.pair.id===i.id});f=y==BSC?4:f;var a=v[e.pair].balance.toString(10),n=3600/f,r=a/Number(i.totalSupply)*Number(i.reserveUSD),o=e.allocPoint/e.owner.totalAllocPoint*e.owner.annexPerBlock/1e18,c=r?2*o*b/r:0,s=c*n,d=24*s,l=30*d,u=12*l;return _objectSpread(_objectSpread({},e),{},{liquidityPair:i,roiPerBlock:c,roiPerHour:s,roiPerDay:d,roiPerMonth:l,roiPerYear:u,rewardPerThousand:1e3/b*d,tvl:i.reserveUSD/i.totalSupply*((null==t?void 0:t.liquidityTokenBalance)||0)})});c(n,a)}).catch(function(t){})}).catch(console.log)}function initUserData(n){var t=window.variables,e=t.ACCOUNT,i=t.farm.POOLS;e&&Promise.all([e?getPoolUser(e):Promise.resolve([]),e&&i?getAllowances(e,i):Promise.resolve([])]).then(function(t){var e=_slicedToArray(t,2),i=e[0],a=e[1];window.variables.farm.USERS=i,window.variables.farm.ALLOWANCES=a,n()}).catch(console.log)}function farmTableRender(){var O=window.variables.farm.USERS||[],D=window.variables.farm.ALLOWANCES||[],q=window.variables.URLS.ADD_LIQUIDITY_URL,T=window.variables.TOKEN_LIST[window.variables.NETWORK||NETWORK];0<pairList.length?pairList.forEach(function(e){var t,i,a,n,r=e.liquidityPair.token1.name?"".concat(e.liquidityPair.token0.name," ").concat(e.liquidityPair.token1.name):e.liquidityPair.token0.name,o=e.liquidityPair.token1.symbol?"".concat(e.liquidityPair.token0.symbol,"-").concat(e.liquidityPair.token1.symbol):e.liquidityPair.token0.symbol,c="".concat(e.liquidityPair.id),s=(T.find(function(t){return t.address.toLowerCase()==e.liquidityPair.token0.id}),T.find(function(t){return t.address.toLowerCase()==e.liquidityPair.token1.id}),e.user),d=e.user.userPercent,l=d.times(null===(t=e.liquidityPair)||void 0===t?void 0:t.reserveUSD),u=d.times(null===(i=e.liquidityPair)||void 0===i?void 0:i.reserve0),m=d.times(null===(a=e.liquidityPair)||void 0===a?void 0:a.reserve1),v=D[e.pair]&&D[e.pair].reward?D[e.pair].reward:"0.00",p=!D[e.pair]||D[e.pair]&&!D[e.pair].reward?"No rewards":"Harvest Now",f='<a class="btn" href="'.concat(q,"/").concat(e.liquidityPair.token0.id,"/").concat(e.liquidityPair.token1.id,'" target="_new">Add Liquidity</a>'),b="",y="";b=(!D[e.pair]||D[e.pair]&&!D[e.pair].allowance)&&new BigNumber(O?((null==s?void 0:s.amount)||0)/1e18:"0.00").isZero()?'<a class="btn btn-link btn-approve-staking" href="#" data-address="'.concat(e.pair,'" data-name="').concat(o,'">Approve Staking</a>'):'<a class="btn js-popup-open"\n                        href="#stake_asset"\n                        data-id="'.concat(e.id,'"\n                        data-address="').concat(e.pair,'"\n                        data-name="').concat(o,'"\n                        data-type="stake"\n                        data-amount="').concat((null===(n=D[e.pair])||void 0===n?void 0:n.balance)||0,'"\n                        data-title="Deposit">Stake</a>'),new BigNumber(O?((null==s?void 0:s.amount)||0)/1e18:"0.00").isZero()||(y='<a class="btn js-popup-open"\n                          href="#stake_asset"\n                          data-id="'.concat(e.id,'"\n                          data-address="').concat(e.pair,'"\n                          data-name="').concat(o,'"\n                          data-type="unstake"\n                          data-amount="').concat(new BigNumber(null==s?void 0:s.amount).div(1e18).toString(10)||0,'"\n                          data-title="Withdraw">UnStake</a>'));var w,g,P,_,k,h,S,N="",N=e.liquidityPair.token1.id?"".concat(formatNumber(u.toNumber(),Number(e.liquidityPair.token0.decimals))," ").concat(e.liquidityPair.token0.symbol," / ").concat(formatNumber(m.toNumber(),Number(e.liquidityPair.token1.decimals))," ").concat(e.liquidityPair.token1.symbol):"".concat(formatNumber(u.toNumber(),Number(e.liquidityPair.token0.decimals))," ").concat(e.liquidityPair.token0.symbol),A=$(".farm-list-items").find("#pair-".concat(c));A.length?(A.find("#pair-".concat(c,"-staked-amount")).text("".concat(formatNumber(l,2,"en","currency","USD"))),A.find("#pair-".concat(c,"-staked-desc")).text("".concat(N)),A.find("#pair-".concat(c,"-earned-title")).text("".concat(formatNumber(v)," ANN")),A.find("#pair-".concat(c,"-earned-desc")).empty(),!D[e.pair]||D[e.pair]&&!D[e.pair].reward?(A.find("#pair-".concat(c,"-earned-desc")).text("".concat(p)),A.find("#pair-".concat(c,"-earned-desc")).removeClass("earn-descr").addClass("descr")):(A.find("#pair-".concat(c,"-earned-desc")).removeClass("descr").addClass("earn-descr"),A.find("#pair-".concat(c,"-earned-desc")).append('\n            <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="'.concat(e.id,'">').concat(p,"</a>\n          "))),A.find("#pair-".concat(c,"-actions")).empty(),A.find("#pair-".concat(c,"-actions")).append("\n          ".concat(f,'\n          <div class="farm-list-items-item-actions__wrapper-buttons">\n            ').concat(b,"\n            ").concat(y,"\n          </div>\n        "))):(P="",P=!D[e.pair]||D[e.pair]&&!D[e.pair].reward?'\n            <div id="pair-'.concat(c,'-earned-desc" class="descr">\n              ').concat(p,"\n            </div>\n          "):'\n            <div id="pair-'.concat(c,'-earned-desc" class="earn-descr">\n              <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="').concat(e.id,'">').concat(p,"</a>\n            </div>\n          "),'<td id="pair-'.concat(c,'-actions" class="td-btns"></td>'),window.variables.NETWORK&&'<td id="pair-'.concat(c,'-actions" class="td-btns">\n            ').concat(f,"\n            ").concat(b,"\n            ").concat(y,"\n          </td>"),_=(null===(w=T.find(function(t){return toChecksumAddress(t.address)===toChecksumAddress(e.liquidityPair.token0.id)}))||void 0===w?void 0:w.logoURI)||"images/defaultAsset.svg",k=(null===(g=T.find(function(t){return toChecksumAddress(t.address)===toChecksumAddress(e.liquidityPair.token1.id)}))||void 0===g?void 0:g.logoURI)||"",h='<img src="'.concat(_,'" alt="').concat(e.liquidityPair.token0.symbol,'">'),S=k?'<img src="'.concat(k,'" alt="').concat(e.liquidityPair.token1.symbol,'">'):"",$("#loading").hide(),$("#no-pools").hide(),$(".farm-list-items").append('\n          <div class="farm-list-items-item" id="pair-'.concat(c,'">\n            <div class="farm-list-items-item-title">\n              <div class="farm-list-items-item-title__icons">\n                <div class="first-icon">\n                  ').concat(h,'\n                </div>\n                <div class="second-icon">\n                  ').concat(S,'\n                </div>\n              </div>\n              <div class="farm-list-items-item-title__text">\n                <p>').concat(r,'</p>\n                <div class="descr">').concat(o,'</div>\n              </div>\n            </div>\n            <div class="farm-list-items-item-content">\n              <div class="farm-list-items-item-content__cell">Yield (per $1,000) : </div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="cell-yield__icon">\n                  <img src="images/ann.svg" alt="ANN">\n                </div>\n                <div class="cell-yield__text">\n                  <p>').concat(formatNumber(e.rewardPerThousand,2),' ANN/Day</p>\n                  <div class="descr">').concat(e.allocPoint,' allocPoint</div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div>\n                  <div class="cell-apy-title">APY</div>\n                  <div class="cell-apy"><span>⬆</span> ').concat(formatNumber(100*e.roiPerYear,2),'%</div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="farm-list-items-item-content__cell-wrapper-right">\n                  <div class="cell-apy-title">Liquidity</div>\n                  <div class="cell-apy">\n                    ').concat(formatNumber(e.liquidityPair.reserveUSD,2,"en","currency","USD"),'\n                  </div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div>\n                  <div class="cell-apy-title">Staked</div>\n                  <p class="cell-apy" id="pair-').concat(c,'-staked-amount">\n                    ').concat(formatNumber(l,2,"en","currency","USD"),'\n                  </p>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="farm-list-items-item-content__cell-wrapper-right">\n                  <div class="staked-assets" id="pair-').concat(c,'-staked-desc">\n                    ').concat(N,'\n                  </div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">Earned</div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="cell-earned__icon">\n                  <img src="images/ann.svg" alt="ANN">\n                </div>\n                <div class="cell-earned__text">\n                  <p id="pair-').concat(c,'-earned-title">').concat(formatNumber(v)," ANN</p>\n                  ").concat(P,'\n                </div>\n              </div>\n            </div>\n            <div class="farm-list-items-item-actions">\n              <div class="farm-list-items-item-actions__wrapper" id="pair-').concat(c,'-actions">\n                ').concat(f,'\n                <div class="farm-list-items-item-actions__wrapper-buttons">\n                  ').concat(b,"\n                  ").concat(y,"\n                </div>\n              </div>\n            </div>\n          </div>\n        ")))}):($("#loading").hide(),$("#no-pools").show())}function harvestNow(t,e){runHarvest([t,e],function(t,e){e&&console.log(e)})}function approveStaking(t,e){runApproveStaking(t,e,function(t,e){e&&console.log(e)})}function onStake(t){var e=$(document.forms.stake),i=e.find("input#available_amount").val(),a=e.find("a.js-input-max-balance").attr("data-value"),n=e.find("#current_stake_type").val(),r=e.find("#current_pool_id").val(),o=e.find("#current_pool_pair_name").val();0<i&&i<=a&&r&&n&&runStake(r,i,o,n,function(t,e){e&&console.log(e)})}function onStakeMaxAmount(t){var e=$(document.forms.stake);e.find("input#available_amount").val(new BigNumber(e.find("a.js-input-max-balance").attr("data-value")).dp(18,1).toString(10))}function onStakeInput(t){var e=$(document.forms.stake),i=e.find("a.js-input-max-balance").attr("data-value");t.target.value>i?$(e).find(".js-confirm-btn").prop("disabled",!0):$(e).find(".js-confirm-btn").prop("disabled",!1)}function isNumber(t){return"number"==typeof t&&isFinite(t)}function onSearch(t){searchKeyward=t,console.log(searchKeyward),searchData()}function searchData(){pairList=window.variables.farm.POOLS.filter(function(t){var e=new RegExp(searchKeyward,"i");return!!(0<=t.liquidityPair.token0.name.search(e)||0<=t.liquidityPair.token0.symbol.search(e)||t.liquidityPair.token1.name&&0<=t.liquidityPair.token1.name.search(e)||t.liquidityPair.token1.symbol&&0<=t.liquidityPair.token1.symbol.search(e))}),sortData()}function onSort(t){sortField=t,sortData()}function sortData(){var n=window.variables.farm.USERS||[],m=window.variables.farm.ALLOWANCES||[];pairList=pairList.map(function(e){var t,i=n.find(function(t){return t.pool.id===e.id}),a=i?new BigNumber(i.amount).div(1e18).div(null===(t=e.liquidityPair)||void 0===t?void 0:t.totalSupply):new BigNumber(0);return _objectSpread(_objectSpread({},e),{},{user:_objectSpread(_objectSpread({},i),{},{userPercent:a})})}).sort(function(t,e){var i,a,n,r;switch(sortField){case"apy":return"asc"===sortDirection?t.roiPerYear-e.roiPerYear:e.roiPerYear-t.roiPerYear;case"liquidity":var o=new BigNumber(null===(i=t.liquidityPair)||void 0===i?void 0:i.reserveUSD),c=new BigNumber(null===(a=e.liquidityPair)||void 0===a?void 0:a.reserveUSD);return"asc"===sortDirection?o.minus(c).toNumber():c.minus(o).toNumber();case"staked":var s=t.user.userPercent.times(null===(n=t.liquidityPair)||void 0===n?void 0:n.reserveUSD),d=e.user.userPercent.times(null===(r=e.liquidityPair)||void 0===r?void 0:r.reserveUSD);return"asc"===sortDirection?s.minus(d).toNumber():d.minus(s).toNumber();case"earned":var l=m[t.pair]&&m[t.pair].reward?new BigNumber(m[t.pair].reward):new BigNumber(0),u=m[e.pair]&&m[e.pair].reward?new BigNumber(m[e.pair].reward):new BigNumber(0);return"asc"===sortDirection?l.minus(u).toNumber():u.minus(l).toNumber();case"allocpoint":return"asc"===sortDirection?t.allocPoint-e.allocPoint:e.allocPoint-t.allocPoint}}),farmTableRender()}window.onload=function(){console.log("onLoad!"),window.events.initHook=initHook,window.triggers.onLoad=[].concat(_toConsumableArray(window.triggers.onLoad||[]),["initHook"]),window.variables.farm={},window.triggers.networkChanged=[].concat(_toConsumableArray(window.triggers.networkChanged||[]),["onNetworkChanged"]),window.events.initFarm=initFarm,window.triggers.selectAccount=[].concat(_toConsumableArray(window.triggers.selectAccount||[]),["initFarm"]),window.events.onNetworkChanged=onNetworkChanged,window.events.onStakeMaxAmount=onStakeMaxAmount,window.events.onStakeInput=onStakeInput,window.events.onStake=onStake,$(document).on("click",".btn-harvest-now",function(t){t.preventDefault(),harvestNow($(this).attr("data-id"),$(this).closest(".cell-earned__text").find("p").text())}),$(document).on("click",".btn-approve-staking",function(t){t.preventDefault(),approveStaking($(this).attr("data-address"),$(this).attr("data-name"))}),$(document).on("change","#farm-sort",function(t){t.preventDefault(),"apy"===t.target.value?onSort("apy"):"allocpoint"===t.target.value?onSort("allocpoint"):"earned"===t.target.value?onSort("earned"):onSort("liquidity")}),$(document).on("change","#farm-search",function(t){t.preventDefault(),console.log(t.target.value),onSearch(t.target.value)})};