"use strict";function ownKeys(a,e){var t,n=Object.keys(a);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(a),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})),n.push.apply(n,t)),n}function _objectSpread(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(a,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))})}return a}function _defineProperty(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function _slicedToArray(e,a){return _arrayWithHoles(e)||_iterableToArrayLimit(e,a)||_unsupportedIterableToArray(e,a)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],n=!0,r=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done)&&(t.push(o.value),!a||t.length!==a);n=!0);}catch(e){r=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,a){if(e){if("string"==typeof e)return _arrayLikeToArray(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,a):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var BSC=56,NETWORK=1,pairList=[],sortField="",sortDirection="";function initHook(){window.hooks.forEach(createHook)}function initFarm(){console.log("initFarm"),initData(function(e,a){window.variables.PAIR_TOKEN_CONTRACTS=a,window.variables.farm.POOLS=e,window.variables.farm.USERS=[],window.variables.farm.ALLOWANCES=[],window.variables.ACCOUNT?updateFarm():(pairList=e,sortData()),refreshFarm()})}function updateFarm(){window.variables.farm.POOLS&&(pairList=window.variables.farm.POOLS,initUserData(function(){sortData()}))}function refreshFarm(){setTimeout(function(){updateFarm(),refreshFarm()},3e4)}function onNetworkChanged(){$("#farm-table-body .farm-item").remove(),$("#loading").show(),$("#no-pools").hide()}function initData(o){var e=window.variables.CONTRACT_TOKEN_ADDRESS,a=void 0===e?values[1].CONTRACT_TOKEN_ADDRESS:e;Promise.all([getLiquidityPositions(),getPools(),getAverageBlockTime(),getToken(a),getEthPrice()]).then(function(e){var a=_slicedToArray(e,5),p=a[0],i=a[1],f=a[2],t=a[3],n=a[4],b=(0!==n.length?n[0].ethPrice:0)*t.derivedETH,r=i.map(function(e){return e.pair}).sort(),y=(window.variables||y).NETWORK;Promise.all([getPairs(r),getFarmSLPBalance(i)]).then(function(e){var a=_slicedToArray(e,2),m=a[0],t=a[1],v=t.balances,n=t.pairTokenContracts,r=i.filter(function(a){return!window.variables.POOL_DENY.includes(a.id)&&"0"!==a.allocPoint&&m.find(function(e){return(null==e?void 0:e.id)===a.pair})}).map(function(a){var t=m.find(function(e){return e.id===a.pair}),e=p.find(function(e){return e.pair.id===t.id});f=y==BSC?4:f;var n=v[a.pair].balance.toString(10),r=3600/f,i=n/Number(t.totalSupply)*Number(t.reserveUSD),o=a.allocPoint/a.owner.totalAllocPoint*a.owner.swipePerBlock/1e18,c=i?2*o*b/i:0,d=c*r,s=24*d,l=30*s,u=12*l;return _objectSpread(_objectSpread({},a),{},{liquidityPair:t,roiPerBlock:c,roiPerHour:d,roiPerDay:s,roiPerMonth:l,roiPerYear:u,rewardPerThousand:1e3/b*s,tvl:t.reserveUSD/t.totalSupply*((null==e?void 0:e.liquidityTokenBalance)||0)})});o(r,n)}).catch(function(e){})}).catch(console.log)}function initUserData(r){var e=window.variables,a=e.ACCOUNT,t=e.farm.POOLS;a&&Promise.all([a?getPoolUser(a):Promise.resolve([]),a&&t?getAllowances(a,t):Promise.resolve([])]).then(function(e){var a=_slicedToArray(e,2),t=a[0],n=a[1];window.variables.farm.USERS=t,window.variables.farm.ALLOWANCES=n,r()}).catch(console.log)}function farmTableRender(){var N=window.variables.farm.USERS||[],O=window.variables.farm.ALLOWANCES||[],T=window.variables.TOKEN_LIST[window.variables.NETWORK||NETWORK];0<pairList.length?($("#farm-table-body .farm-item").remove(),pairList.forEach(function(a){var e,t,n,r,i="".concat(a.liquidityPair.token0.name," ").concat(a.liquidityPair.token1.name),o="".concat(a.liquidityPair.token0.symbol,"-").concat(a.liquidityPair.token1.symbol),c=T.find(function(e){return e.address.toLowerCase()==a.liquidityPair.token0.id}),d=T.find(function(e){return e.address.toLowerCase()==a.liquidityPair.token1.id}),s=a.user,l=a.user.userPercent,u=l.times(null===(e=a.liquidityPair)||void 0===e?void 0:e.reserveUSD),m=l.times(null===(t=a.liquidityPair)||void 0===t?void 0:t.reserve0),v=l.times(null===(n=a.liquidityPair)||void 0===n?void 0:n.reserve1),p=O[a.pair]&&O[a.pair].reward?O[a.pair].reward:"0.00",f=!O[a.pair]||O[a.pair]&&!O[a.pair].reward?"No rewards":"Harvest Now",b='<a class="btn btn-lbiege" href="add-liquidity?type=add&inputCurrency='.concat(a.liquidityPair.token0.id,"&outputCurrency=").concat(a.liquidityPair.token1.id,'">Add Liquidity</a>'),y="",w="";y=(!O[a.pair]||O[a.pair]&&!O[a.pair].allowance)&&new BigNumber(N?((null==s?void 0:s.amount)||0)/1e18:"0.00").isZero()?'<a class="btn btn-link btn-approve-staking" href="#" data-address="'.concat(a.pair,'" data-name="').concat(o,'">Approve Staking</a>'):'<a class="btn btn-link js-popup-open"\n                        href="#stake_asset"\n                        data-id="'.concat(a.id,'"\n                        data-address="').concat(a.pair,'"\n                        data-name="').concat(o,'"\n                        data-type="stake"\n                        data-amount="').concat((null===(r=O[a.pair])||void 0===r?void 0:r.balance)||0,'"\n                        data-title="Deposit">Stake</a>'),new BigNumber(N?((null==s?void 0:s.amount)||0)/1e18:"0.00").isZero()||(w='<a class="btn btn-link js-popup-open"\n                          href="#stake_asset"\n                          data-id="'.concat(a.id,'"\n                          data-address="').concat(a.pair,'"\n                          data-name="').concat(o,'"\n                          data-type="unstake"\n                          data-amount="').concat(new BigNumber(null==s?void 0:s.amount).div(1e18).toString(10)||0,'"\n                          data-title="Withdraw">UnStake</a>'));var g,S,k,h,P,_,A=$("#farm-table-body").find("#pair-".concat(o));A.length?(A.find("#pair-".concat(o,"-staked-amount")).text("".concat(formatNumber(u,2,"en","currency","USD"))),A.find("#pair-".concat(o,"-staked-desc")).text("".concat(formatNumber(m,c.decimals)," ").concat(c.symbol," / ").concat(formatNumber(v,d.decimals)," ").concat(d.symbol)),A.find("#pair-".concat(o,"-earned-title")).text("".concat(formatNumber(p)," SXP")),A.find("#pair-".concat(o,"-earned-desc")).empty(),!O[a.pair]||O[a.pair]&&!O[a.pair].reward?(A.find("#pair-".concat(o,"-earned-desc")).text("".concat(f)),A.find("#pair-".concat(o,"-earned-desc")).removeClass("earn-descr").addClass("descr")):(A.find("#pair-".concat(o,"-earned-desc")).removeClass("descr").addClass("earn-descr"),A.find("#pair-".concat(o,"-earned-desc")).append('\n            <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="'.concat(a.id,'">').concat(f,"</a>\n          "))),A.find("#pair-".concat(o,"-actions")).empty(),A.find("#pair-".concat(o,"-actions")).append("\n          ".concat(b,"\n          ").concat(y,"\n          ").concat(w,"\n        "))):(k="",k=!O[a.pair]||O[a.pair]&&!O[a.pair].reward?'\n            <div id="pair-'.concat(o,'-earned-desc" class="descr">\n              ').concat(f,"\n            </div>\n          "):'\n            <div id="pair-'.concat(o,'-earned-desc" class="earn-descr">\n              <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="').concat(a.id,'">').concat(f,"</a>\n            </div>\n          "),h='<td id="pair-'.concat(o,'-actions" class="td-btns"></td>'),window.variables.NETWORK&&(h='<td id="pair-'.concat(o,'-actions" class="td-btns">\n            ').concat(b,"\n            ").concat(y,"\n            ").concat(w,"\n          </td>")),P=(null===(g=T.find(function(e){return toChecksumAddress(e.address)===toChecksumAddress(a.liquidityPair.token0.id)}))||void 0===g?void 0:g.logoURI)||"images/defaultAsset.svg",_=(null===(S=T.find(function(e){return toChecksumAddress(e.address)===toChecksumAddress(a.liquidityPair.token1.id)}))||void 0===S?void 0:S.logoURI)||"images/defaultAsset.svg",$("#loading").hide(),$("#no-pools").hide(),$("#farm-table-body").append('\n          <tr id="pair-'.concat(o,'" class="farm-item">\n            <td>\n              <div class="cell-title">Farm : </div>\n              <div class="cell-farms">\n                <div class="cell-farms__icons">\n                  <div class="first-icon">\n                    <img src="').concat(P,'" alt="').concat(a.liquidityPair.token0.symbol,'">\n                  </div>\n                  <div class="second-icon">\n                    <img src="').concat(_,'" alt="').concat(a.liquidityPair.token1.symbol,'">\n                  </div>\n                </div>\n                <div class="cell-farms__text">\n                  <p>').concat(i,'</p>\n                  <div class="descr">').concat(o,'</div>\n                </div>\n              </div>\n            </td>\n            <td>\n              <div class="cell-title">Yield(per $1,000) : </div>\n              <div class="cell-yield">\n                <div class="cell-yield__icon">\n                  <img src="images/sxp.svg" alt="sxp">\n                </div>\n                <div class="cell-yield__text">\n                  <p>').concat(formatNumber(a.rewardPerThousand,2),' SXP/Day</p>\n                  <div class="descr">').concat(a.allocPoint,' allocPoint</div>\n                </div>\n              </div>\n            </td>\n            <td class="').concat(0<=100*a.roiPerYear?"td-apy-raised":"td-apy-down",'">\n              <div class="cell-title">APY : </div>\n              <div class="td-apy-raised--value">\n                <span>⬆ ').concat(formatNumber(100*a.roiPerYear,2),'%</span>\n              </div>\n            </td>\n            <td class="farm-liquidity">\n              <div class="cell-title">Liquidity : </div>\n              <div class="farm-liquidity-value" title="').concat(formatNumber(a.liquidityPair.reserveUSD,2,"en","currency","USD"),'">\n                ').concat(formatNumber(a.liquidityPair.reserveUSD,2,"en","currency","USD"),'\n              </div>\n            </td>\n            <td>\n              <div class="cell-title">Staked : </div>\n              <div class="cell-staked">\n                <p id="pair-').concat(o,'-staked-amount">\n                  ').concat(formatNumber(u,2,"en","currency","USD"),'\n                </p>\n                <div class="descr" id="pair-').concat(o,'-staked-desc">\n                  ').concat(formatNumber(m.toNumber(),c.decimals)," ").concat(c.symbol," / ").concat(formatNumber(v.toNumber(),d.decimals)," ").concat(d.symbol,'\n                </div>\n              </div>\n            </td>\n            <td>\n              <div class="cell-title">Earned : </div>\n              <div class="cell-earned">\n                <div class="cell-earned__icon">\n                  <img src="images/sxp.svg">\n                </div>\n                <div class="cell-earned__text">\n                  <p id="pair-').concat(o,'-earned-title">').concat(formatNumber(p)," SXP</p>\n                  ").concat(k,"\n                </div>\n              </div>\n            </td>\n            ").concat(h,"\n          </tr>\n        ")))})):($("#loading").hide(),$("#no-pools").show())}function harvestNow(e,a){runHarvest([e,a],function(e,a){a&&console.log(a)})}function approveStaking(e,a){runApproveStaking(e,a,function(e,a){a&&console.log(a)})}function onStake(e){var a=$(document.forms.stake),t=a.find("input#available_amount").val(),n=a.find("a.js-input-max-balance").attr("data-value"),r=a.find("#current_stake_type").val(),i=a.find("#current_pool_id").val(),o=a.find("#current_pool_pair_name").val();0<t&&t<=n&&i&&r&&runStake(i,t,o,r,function(e,a){a&&console.log(a)})}function onStakeMaxAmount(e){var a=$(document.forms.stake);a.find("input#available_amount").val(new BigNumber(a.find("a.js-input-max-balance").attr("data-value")).dp(18,1).toString(10))}function onStakeInput(e){var a=$(document.forms.stake),t=a.find("a.js-input-max-balance").attr("data-value");e.target.value>t?$(a).find(".js-confirm-btn").prop("disabled",!0):$(a).find(".js-confirm-btn").prop("disabled",!1)}function isNumber(e){return"number"==typeof e&&isFinite(e)}function onSort(e){sortDirection=$(".farm-table-header-".concat(sortField=e)).hasClass("desc")?"asc":"desc",$(".farm-table-header").removeClass("asc").removeClass("desc"),$(".farm-table-header-".concat(e)).addClass(sortDirection),sortData()}function sortData(){var r=window.variables.farm.USERS||[];pairList=pairList.map(function(a){var e,t=r.find(function(e){return e.pool.id===a.id}),n=t?new BigNumber(t.amount).div(1e18).div(null===(e=a.liquidityPair)||void 0===e?void 0:e.totalSupply):new BigNumber(0);return _objectSpread(_objectSpread({},a),{},{user:_objectSpread(_objectSpread({},t),{},{userPercent:n})})}).sort(function(e,a){var t,n,r,i;switch(sortField){case"apy":return"asc"===sortDirection?e.roiPerYear-a.roiPerYear:a.roiPerYear-e.roiPerYear;case"liquidity":var o=new BigNumber(null===(t=e.liquidityPair)||void 0===t?void 0:t.reserveUSD),c=new BigNumber(null===(n=a.liquidityPair)||void 0===n?void 0:n.reserveUSD);return"asc"===sortDirection?o.minus(c).toNumber():c.minus(o).toNumber();case"staked":var d=e.user.userPercent.times(null===(r=e.liquidityPair)||void 0===r?void 0:r.reserveUSD),s=a.user.userPercent.times(null===(i=a.liquidityPair)||void 0===i?void 0:i.reserveUSD);return"asc"===sortDirection?d.minus(s).toNumber():s.minus(d).toNumber()}}),farmTableRender()}window.onload=function(){console.log("onLoad!"),window.events.initHook=initHook,window.triggers.onLoad=[].concat(_toConsumableArray(window.triggers.onLoad||[]),["initHook"]),window.variables.farm={},window.triggers.networkChanged=[].concat(_toConsumableArray(window.triggers.networkChanged||[]),["onNetworkChanged"]),window.events.initFarm=initFarm,window.triggers.selectAccount=[].concat(_toConsumableArray(window.triggers.selectAccount||[]),["initFarm"]),window.events.onNetworkChanged=onNetworkChanged,window.events.onStakeMaxAmount=onStakeMaxAmount,window.events.onStakeInput=onStakeInput,window.events.onStake=onStake,$(document).on("click",".btn-harvest-now",function(e){e.preventDefault(),harvestNow($(this).attr("data-id"),$(this).closest(".cell-earned__text").find("p").text())}),$(document).on("click",".btn-approve-staking",function(e){e.preventDefault(),approveStaking($(this).attr("data-address"),$(this).attr("data-name"))}),$(document).on("click",".farm-table-header-apy",function(e){e.preventDefault(),onSort("apy")}),$(document).on("click",".farm-table-header-liquidity",function(e){e.preventDefault(),onSort("liquidity")}),$(document).on("click",".farm-table-header-staked",function(e){e.preventDefault(),onSort("staked")}),window.variables.NETWORK||initFarm()};