"use strict";function ownKeys(t,e){var n,a=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)),a}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,i=!1,r=void 0;try{for(var o,c=e[Symbol.iterator]();!(a=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw r}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var BSC=56,NETWORK=1,pairList=[],sortField="",sortDirection="";function initHook(){window.hooks.forEach(createHook)}function initFarm(){console.log("initFarm"),initData(function(e,t){console.log("POOOOOOOLS : ",e),window.variables.PAIR_TOKEN_CONTRACTS=t,window.variables.farm.POOLS=e,window.variables.farm.USERS=[],window.variables.farm.ALLOWANCES=[],window.variables.ACCOUNT?updateFarm():(pairList=e,sortData()),refreshFarm()})}function updateFarm(){window.variables.farm.POOLS&&(pairList=window.variables.farm.POOLS,initUserData(function(){sortData()}))}function refreshFarm(){setTimeout(function(){updateFarm(),refreshFarm()},3e4)}function onNetworkChanged(){$("#farm-table-body .farm-item").remove(),$("#loading").show(),$("#no-pools").hide()}function initData(c){var e=window.variables.CONTRACT_TOKEN_ADDRESS,t=void 0===e?values[56].CONTRACT_TOKEN_ADDRESS:e;Promise.all([getLiquidityPositions(),getPools(),getAverageBlockTime(),getToken(t),getEthPrice()]).then(function(e){var t=_slicedToArray(e,5),f=t[0],r=t[1],p=t[2],n=t[3],a=t[4];console.log([f,r,p,n,a]);var i=0!==a.length?a[0].ethPrice:0,b=i*n.derivedETH,o=r.map(function(e){return e.pair}).sort(),y=(window.variables||y).NETWORK;console.log("annexPrice: ",b),Promise.all([getPairs(o,i,b),getFarmALPBalance(r)]).then(function(e){var t=_slicedToArray(e,2),m=t[0],n=t[1],v=n.balances,a=n.pairTokenContracts,i=r.filter(function(t){return!window.variables.POOL_DENY.includes(t.id)&&"0"!==t.allocPoint&&m.find(function(e){return(null==e?void 0:e.id)===t.pair})}).map(function(t){var n=m.find(function(e){return e.id===t.pair}),e=f.find(function(e){return e.pair.id===n.id});p=y==BSC?4:p;var a=v[t.pair].balance.toString(10),i=3600/p,r=a/Number(n.totalSupply)*Number(n.reserveUSD),o=t.allocPoint/t.owner.totalAllocPoint*t.owner.annexPerBlock/1e18,c=r?2*o*b/r:0,s=c*i,d=24*s,l=30*d,u=12*l;return _objectSpread(_objectSpread({},t),{},{liquidityPair:n,roiPerBlock:c,roiPerHour:s,roiPerDay:d,roiPerMonth:l,roiPerYear:u,rewardPerThousand:1e3/b*d,tvl:n.reserveUSD/n.totalSupply*((null==e?void 0:e.liquidityTokenBalance)||0)})});c(i,a)}).catch(function(e){})}).catch(console.log)}function initUserData(i){var e=window.variables,t=e.ACCOUNT,n=e.farm.POOLS;t&&Promise.all([t?getPoolUser(t):Promise.resolve([]),t&&n?getAllowances(t,n):Promise.resolve([])]).then(function(e){var t=_slicedToArray(e,2),n=t[0],a=t[1];console.log("^^^^^ ",[n,a]),window.variables.farm.USERS=n,window.variables.farm.ALLOWANCES=a,i()}).catch(console.log)}function farmTableRender(){var S=window.variables.farm.USERS||[],N=window.variables.farm.ALLOWANCES||[],A=window.variables.TOKEN_LIST[window.variables.NETWORK||NETWORK];console.log("assets : ",A),0<pairList.length?($("#farm-table-body .farm-item").remove(),pairList.forEach(function(t){var e,n,a,i,r=t.liquidityPair.token1.name?"".concat(t.liquidityPair.token0.name," ").concat(t.liquidityPair.token1.name):t.liquidityPair.token0.name,o=t.liquidityPair.token1.symbol?"".concat(t.liquidityPair.token0.symbol,"-").concat(t.liquidityPair.token1.symbol):t.liquidityPair.token0.symbol,c=(A.find(function(e){return e.address.toLowerCase()==t.liquidityPair.token0.id}),A.find(function(e){return e.address.toLowerCase()==t.liquidityPair.token1.id}),t.user),s=t.user.userPercent,d=s.times(null===(e=t.liquidityPair)||void 0===e?void 0:e.reserveUSD),l=s.times(null===(n=t.liquidityPair)||void 0===n?void 0:n.reserve0),u=s.times(null===(a=t.liquidityPair)||void 0===a?void 0:a.reserve1),m=N[t.pair]&&N[t.pair].reward?N[t.pair].reward:"0.00",v=!N[t.pair]||N[t.pair]&&!N[t.pair].reward?"No rewards":"Harvest Now",f='<a class="btn" href="add-liquidity?type=add&inputCurrency='.concat(t.liquidityPair.token0.id,"&outputCurrency=").concat(t.liquidityPair.token1.id,'">Add Liquidity</a>'),p="",b="";p=(!N[t.pair]||N[t.pair]&&!N[t.pair].allowance)&&new BigNumber(S?((null==c?void 0:c.amount)||0)/1e18:"0.00").isZero()?'<a class="btn btn-link btn-approve-staking" href="#" data-address="'.concat(t.pair,'" data-name="').concat(o,'">Approve Staking</a>'):'<a class="btn js-popup-open"\n                        href="#stake_asset"\n                        data-id="'.concat(t.id,'"\n                        data-address="').concat(t.pair,'"\n                        data-name="').concat(o,'"\n                        data-type="stake"\n                        data-amount="').concat((null===(i=N[t.pair])||void 0===i?void 0:i.balance)||0,'"\n                        data-title="Deposit">Stake</a>'),new BigNumber(S?((null==c?void 0:c.amount)||0)/1e18:"0.00").isZero()||(b='<a class="btn js-popup-open"\n                          href="#stake_asset"\n                          data-id="'.concat(t.id,'"\n                          data-address="').concat(t.pair,'"\n                          data-name="').concat(o,'"\n                          data-type="unstake"\n                          data-amount="').concat(new BigNumber(null==c?void 0:c.amount).div(1e18).toString(10)||0,'"\n                          data-title="Withdraw">UnStake</a>'));var y,w,g,_,k,P="",P=t.liquidityPair.token1.id?"".concat(formatNumber(l.toNumber(),Number(t.liquidityPair.token0.decimals))," ").concat(t.liquidityPair.token0.symbol," / ").concat(formatNumber(u.toNumber(),Number(t.liquidityPair.token1.decimals))," ").concat(t.liquidityPair.token1.symbol):"".concat(formatNumber(l.toNumber(),Number(t.liquidityPair.token0.decimals))," ").concat(t.liquidityPair.token0.symbol),h=$(".farm-list-items").find("#pair-".concat(o));h.length?(h.find("#pair-".concat(o,"-staked-amount")).text("".concat(formatNumber(d,2,"en","currency","USD"))),h.find("#pair-".concat(o,"-staked-desc")).text("".concat(P)),h.find("#pair-".concat(o,"-earned-title")).text("".concat(formatNumber(m)," SXP")),h.find("#pair-".concat(o,"-earned-desc")).empty(),!N[t.pair]||N[t.pair]&&!N[t.pair].reward?(h.find("#pair-".concat(o,"-earned-desc")).text("".concat(v)),h.find("#pair-".concat(o,"-earned-desc")).removeClass("earn-descr").addClass("descr")):(h.find("#pair-".concat(o,"-earned-desc")).removeClass("descr").addClass("earn-descr"),h.find("#pair-".concat(o,"-earned-desc")).append('\n            <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="'.concat(t.id,'">').concat(v,"</a>\n          "))),h.find("#pair-".concat(o,"-actions")).empty(),h.find("#pair-".concat(o,"-actions")).append("\n          ".concat(f,"\n          ").concat(p,"\n          ").concat(b,"\n        "))):(g="",g=!N[t.pair]||N[t.pair]&&!N[t.pair].reward?'\n            <div id="pair-'.concat(o,'-earned-desc" class="descr">\n              ').concat(v,"\n            </div>\n          "):'\n            <div id="pair-'.concat(o,'-earned-desc" class="earn-descr">\n              <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="').concat(t.id,'">').concat(v,"</a>\n            </div>\n          "),'<td id="pair-'.concat(o,'-actions" class="td-btns"></td>'),window.variables.NETWORK&&'<td id="pair-'.concat(o,'-actions" class="td-btns">\n            ').concat(f,"\n            ").concat(p,"\n            ").concat(b,"\n          </td>"),_=(null===(y=A.find(function(e){return toChecksumAddress(e.address)===toChecksumAddress(t.liquidityPair.token0.id)}))||void 0===y?void 0:y.logoURI)||"images/defaultAsset.svg",k=(null===(w=A.find(function(e){return toChecksumAddress(e.address)===toChecksumAddress(t.liquidityPair.token1.id)}))||void 0===w?void 0:w.logoURI)||"images/defaultAsset.svg",$("#loading").hide(),$("#no-pools").hide(),$(".farm-list-items").append('\n          <div class="farm-list-items-item" id="pair-'.concat(o,'">\n            <div class="farm-list-items-item-title">\n              <div class="farm-list-items-item-title__icons">\n                <div class="first-icon">\n                  <img src="').concat(_,'" alt="').concat(t.liquidityPair.token0.symbol,'">\n                </div>\n                <div class="second-icon">\n                  <img src="').concat(k,'" alt="').concat(t.liquidityPair.token1.symbol,'">\n                </div>\n              </div>\n              <div class="farm-list-items-item-title__text">\n                <p>').concat(r,'</p>\n                <div class="descr">').concat(o,'</div>\n              </div>\n            </div>\n            <div class="farm-list-items-item-content">\n              <div class="farm-list-items-item-content__cell">Yield (per $1,000) : </div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="cell-yield__icon">\n                  <img src="images/ann.svg" alt="ANN">\n                </div>\n                <div class="cell-yield__text">\n                  <p>').concat(formatNumber(t.rewardPerThousand,2),' ANN/Day</p>\n                  <div class="descr">').concat(t.allocPoint,' allocPoint</div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div>\n                  <div class="cell-apy-title">APY</div>\n                  <div class="cell-apy"><span>â¬†</span> ').concat(formatNumber(100*t.roiPerYear,2),'%</div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="farm-list-items-item-content__cell-wrapper-right">\n                  <div class="cell-apy-title">Liquidity</div>\n                  <div class="cell-apy">\n                    ').concat(formatNumber(t.liquidityPair.reserveUSD,2,"en","currency","USD"),'\n                  </div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div>\n                  <div class="cell-apy-title">Staked</div>\n                  <p class="cell-apy" id="pair-').concat(o,'-staked-amount">\n                    ').concat(formatNumber(d,2,"en","currency","USD"),'\n                  </p>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="farm-list-items-item-content__cell-wrapper-right">\n                  <div class="staked-assets" id="pair-').concat(o,'-staked-desc">\n                    ').concat(P,'\n                  </div>\n                </div>\n              </div>\n              <div class="farm-list-items-item-content__cell">Earned</div>\n              <div class="farm-list-items-item-content__cell">\n                <div class="cell-earned__icon">\n                  <img src="images/ann.svg" alt="ANN">\n                </div>\n                <div class="cell-earned__text">\n                  <p id="pair-').concat(o,'-earned-title">').concat(formatNumber(m)," ANN</p>\n                  ").concat(g,'\n                </div>\n              </div>\n            </div>\n            <div class="farm-list-items-item-actions">\n              <div class="farm-list-items-item-actions__wrapper" id="pair-').concat(o,'-actions">\n                ').concat(f,'\n                <div class="farm-list-items-item-actions__wrapper-buttons">\n                  ').concat(p,"\n                  ").concat(b,"\n                </div>\n              </div>\n            </div>\n          </div>\n        ")))})):($("#loading").hide(),$("#no-pools").show())}function harvestNow(e,t){runHarvest([e,t],function(e,t){t&&console.log(t)})}function approveStaking(e,t){runApproveStaking(e,t,function(e,t){t&&console.log(t)})}function onStake(e){var t=$(document.forms.stake),n=t.find("input#available_amount").val(),a=t.find("a.js-input-max-balance").attr("data-value"),i=t.find("#current_stake_type").val(),r=t.find("#current_pool_id").val(),o=t.find("#current_pool_pair_name").val();0<n&&n<=a&&r&&i&&runStake(r,n,o,i,function(e,t){t&&console.log(t)})}function onStakeMaxAmount(e){var t=$(document.forms.stake);t.find("input#available_amount").val(new BigNumber(t.find("a.js-input-max-balance").attr("data-value")).dp(18,1).toString(10))}function onStakeInput(e){var t=$(document.forms.stake),n=t.find("a.js-input-max-balance").attr("data-value");e.target.value>n?$(t).find(".js-confirm-btn").prop("disabled",!0):$(t).find(".js-confirm-btn").prop("disabled",!1)}function isNumber(e){return"number"==typeof e&&isFinite(e)}function onSort(e){sortDirection=$(".farm-table-header-".concat(sortField=e)).hasClass("desc")?"asc":"desc",$(".farm-table-header").removeClass("asc").removeClass("desc"),$(".farm-table-header-".concat(e)).addClass(sortDirection),sortData()}function sortData(){var i=window.variables.farm.USERS||[];pairList=pairList.map(function(t){var e,n=i.find(function(e){return e.pool.id===t.id}),a=n?new BigNumber(n.amount).div(1e18).div(null===(e=t.liquidityPair)||void 0===e?void 0:e.totalSupply):new BigNumber(0);return _objectSpread(_objectSpread({},t),{},{user:_objectSpread(_objectSpread({},n),{},{userPercent:a})})}).sort(function(e,t){var n,a,i,r;switch(sortField){case"apy":return"asc"===sortDirection?e.roiPerYear-t.roiPerYear:t.roiPerYear-e.roiPerYear;case"liquidity":var o=new BigNumber(null===(n=e.liquidityPair)||void 0===n?void 0:n.reserveUSD),c=new BigNumber(null===(a=t.liquidityPair)||void 0===a?void 0:a.reserveUSD);return"asc"===sortDirection?o.minus(c).toNumber():c.minus(o).toNumber();case"staked":var s=e.user.userPercent.times(null===(i=e.liquidityPair)||void 0===i?void 0:i.reserveUSD),d=t.user.userPercent.times(null===(r=t.liquidityPair)||void 0===r?void 0:r.reserveUSD);return"asc"===sortDirection?s.minus(d).toNumber():d.minus(s).toNumber()}}),farmTableRender()}window.onload=function(){console.log("onLoad!"),window.events.initHook=initHook,window.triggers.onLoad=[].concat(_toConsumableArray(window.triggers.onLoad||[]),["initHook"]),window.variables.farm={},window.triggers.networkChanged=[].concat(_toConsumableArray(window.triggers.networkChanged||[]),["onNetworkChanged"]),window.events.initFarm=initFarm,window.triggers.selectAccount=[].concat(_toConsumableArray(window.triggers.selectAccount||[]),["initFarm"]),window.events.onNetworkChanged=onNetworkChanged,window.events.onStakeMaxAmount=onStakeMaxAmount,window.events.onStakeInput=onStakeInput,window.events.onStake=onStake,$(document).on("click",".btn-harvest-now",function(e){e.preventDefault(),harvestNow($(this).attr("data-id"),$(this).closest(".cell-earned__text").find("p").text())}),$(document).on("click",".btn-approve-staking",function(e){e.preventDefault(),approveStaking($(this).attr("data-address"),$(this).attr("data-name"))}),$(document).on("click",".farm-table-header-apy",function(e){e.preventDefault(),onSort("apy")}),$(document).on("click",".farm-table-header-liquidity",function(e){e.preventDefault(),onSort("liquidity")}),$(document).on("click",".farm-table-header-staked",function(e){e.preventDefault(),onSort("staked")}),window.variables.NETWORK||initFarm()};